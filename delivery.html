<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relat칩rio de Transporte - Prot칩tipo</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    h1, h2 { text-align: center; }
    form { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    label { display: block; margin-top: 10px; }
    input { width: 100%; padding: 6px; margin-top: 5px; }
    button { margin-top: 15px; padding: 10px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #2980b9; }
    .dashboard { background: white; padding: 20px; border-radius: 8px; }
    canvas { margin-top: 20px; }
  </style>
</head>
<body>

  <h1>游늶 Relat칩rio de Transporte</h1>

  <!-- Formul치rio de preenchimento -->
  <form id="relatorioForm">
    <label>Funcion치rio:</label>
    <input type="text" id="funcionario" required>
    
    <label>Data:</label>
    <input type="date" id="data" required>
    
    <label>Refei칞칚o (R$):</label>
    <input type="number" id="refeicao" required>
    
    <label>Condu칞칚o (R$):</label>
    <input type="number" id="conducao" required>
    
    <label>Retorno Casa (R$):</label>
    <input type="number" id="retorno" required>
    
    <button type="submit">Enviar Relat칩rio</button>
  </form>

  <!-- Dashboard -->
  <div class="dashboard">
    <h2>游늵 Dashboard do Dono</h2>
    <canvas id="barChart"></canvas>
    <canvas id="pieChart"></canvas>
    <canvas id="lineChart"></canvas>
  </div>

  <script>
    let registros = [];
    const form = document.getElementById("relatorioForm");

    // Configura칞칚o dos gr치ficos
    const barCtx = document.getElementById("barChart").getContext("2d");
    const pieCtx = document.getElementById("pieChart").getContext("2d");
    const lineCtx = document.getElementById("lineChart").getContext("2d");

    let barChart = new Chart(barCtx, {
      type: "bar",
      data: { labels: [], datasets: [] }
    });

    let pieChart = new Chart(pieCtx, {
      type: "pie",
      data: { labels: ["Refei칞칚o", "Condu칞칚o", "Retorno"], datasets: [{ data: [0,0,0], backgroundColor: ["#3498db","#2ecc71","#e74c3c"] }] }
    });

    let lineChart = new Chart(lineCtx, {
      type: "line",
      data: { labels: [], datasets: [{ label: "Total Di치rio", data: [], borderColor: "#9b59b6", fill: false }] }
    });

    // Atualiza os gr치ficos
    function atualizarDashboard() {
      // Dados agrupados por funcion치rio
      const funcionarios = [...new Set(registros.map(r => r.funcionario))];
      const refeicoes = funcionarios.map(f => registros.filter(r => r.funcionario===f).reduce((s,r)=>s+r.refeicao,0));
      const conducoes = funcionarios.map(f => registros.filter(r => r.funcionario===f).reduce((s,r)=>s+r.conducao,0));
      const retornos = funcionarios.map(f => registros.filter(r => r.funcionario===f).reduce((s,r)=>s+r.retorno,0));

      barChart.data = {
        labels: funcionarios,
        datasets: [
          { label: "Refei칞칚o", data: refeicoes, backgroundColor: "#3498db" },
          { label: "Condu칞칚o", data: conducoes, backgroundColor: "#2ecc71" },
          { label: "Retorno", data: retornos, backgroundColor: "#e74c3c" }
        ]
      };
      barChart.update();

      // Atualiza Pizza
      const totalRefeicao = registros.reduce((s,r)=>s+r.refeicao,0);
      const totalConducao = registros.reduce((s,r)=>s+r.conducao,0);
      const totalRetorno = registros.reduce((s,r)=>s+r.retorno,0);

      pieChart.data.datasets[0].data = [totalRefeicao, totalConducao, totalRetorno];
      pieChart.update();

      // Atualiza Linha (por data)
      const datas = [...new Set(registros.map(r=>r.data))].sort();
      const totais = datas.map(d => registros.filter(r=>r.data===d).reduce((s,r)=>s+r.total,0));

      lineChart.data.labels = datas;
      lineChart.data.datasets[0].data = totais;
      lineChart.update();
    }

    // Submiss칚o do formul치rio
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const funcionario = document.getElementById("funcionario").value;
      const data = document.getElementById("data").value;
      const refeicao = parseFloat(document.getElementById("refeicao").value);
      const conducao = parseFloat(document.getElementById("conducao").value);
      const retorno = parseFloat(document.getElementById("retorno").value);
      const total = refeicao + conducao + retorno;

      registros.push({ funcionario, data, refeicao, conducao, retorno, total });
      atualizarDashboard();
      form.reset();
    });
  </script>

</body>
</html>