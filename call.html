<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rob√¥ Aviator - Mega Ultra</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#0d1117; color:#e6edf3; margin:0; padding:20px; }
    h1 { text-align:center; }
    textarea, select { width:100%; margin:10px 0; padding:10px; border-radius:8px; border:1px solid #30363d; background:#161b22; color:#fff; }
    button { padding:10px 20px; border:0; border-radius:8px; background:#238636; color:#fff; cursor:pointer; font-weight:bold; margin-top:10px; }
    .result { margin-top:20px; padding:15px; background:#161b22; border-radius:8px; transition: all 0.5s ease; }
    .highlight { font-size:20px; font-weight:bold; }
    .alerta { border:2px solid #ff0000; background:#400; }
    canvas { margin-top:20px; background:#fff; border-radius:8px; }
    h2 { margin-top:30px; }
    .hist { margin-top:10px; display:grid; gap:10px; }
    .item { background:#161b22; padding:10px; border-radius:8px; border:1px solid #30363d; }
    .badge { padding:3px 8px; border-radius:999px; font-size:12px; }
    .verde { background:#2ea043; color:#000; }
    .amarelo { background:#d29922; color:#000; }
    .vermelho { background:#da3633; color:#fff; }
  </style>
</head>
<body>
  <h1>üìä Rob√¥ Aviator - Mega Ultra</h1>
  <p>Cole abaixo os √∫ltimos resultados (separados por v√≠rgula):</p>
  <textarea id="input" placeholder="Ex.: 1.10, 1.50, 2.30, 10.00, 1.20"></textarea>
  <label>Analisar √∫ltimas:
    <select id="janela">
      <option value="10">10 rodadas</option>
      <option value="20">20 rodadas</option>
      <option value="50">50 rodadas</option>
    </select>
  </label>
  <button onclick="analisar()">Analisar</button>

  <div class="result" id="output"></div>
  <canvas id="chart" height="120"></canvas>

  <!-- Hist√≥rico -->
  <h2>üìú Hist√≥rico de An√°lises</h2>
  <div class="hist" id="hist"></div>

  <!-- Som de alerta -->
  <audio id="beep">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
  </audio>

  <script>
    let historico = [];

    function analisar(){
      const input = document.getElementById("input").value;
      if(!input.trim()){ alert("Cole os resultados!"); return; }

      const valores = input.split(",").map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
      const janela = parseInt(document.getElementById("janela").value);
      const ultimos = valores.slice(-janela);

      let baixos = ultimos.filter(v => v <= 2).length;
      let medios = ultimos.filter(v => v > 2 && v <= 10).length;
      let altos = ultimos.filter(v => v > 10).length;

      // detectar sequ√™ncias de rodadas baixas consecutivas
      let seqBaixa = 0, maxSeqBaixa = 0;
      for(let v of ultimos){
        if(v <= 2){ seqBaixa++; maxSeqBaixa = Math.max(maxSeqBaixa, seqBaixa); }
        else { seqBaixa = 0; }
      }

      // √∫ltima explos√£o
      let ultimaAlta = ultimos.length - 1 - [...ultimos].reverse().findIndex(v => v > 10);
      let desdeAlta = (ultimaAlta === -1) ? "Nunca" : (ultimos.length - 1 - ultimaAlta) + " rodadas atr√°s";

      // m√©dias m√≥veis
      let mediaCurta = media(ultimos.slice(-10));
      let mediaLonga = media(ultimos);

      // probabilidade (heur√≠stica)
      let probMedia = (maxSeqBaixa >= 3) ? Math.min(90, 40 + maxSeqBaixa*10) : 30;
      let probAlta = (desdeAlta !== "Nunca" && parseInt(desdeAlta) >= 10) ? 50 : 20;

      // classifica√ß√£o textual
      let call = "";
      let cor = "amarelo";
      if(maxSeqBaixa >= 5){
        call = "‚ö†Ô∏è Muitas rodadas baixas consecutivas ‚Üí pode vir rodada m√©dia/alta.";
        cor = "verde";
      } else if(altos === 0){
        call = "üî¥ Nenhuma explos√£o detectada nesta janela ‚Üí tend√™ncia baixa.";
        cor = "vermelho";
      } else {
        call = "üü° Situa√ß√£o equilibrada ‚Üí chance moderada de rodada m√©dia.";
        cor = "amarelo";
      }

      // sa√≠da principal
      const outBox = document.getElementById("output");
      outBox.innerHTML = `
        <div class="highlight ${cor}">${call}</div><br>
        Total analisado: <b>${ultimos.length}</b><br>
        Baixas (‚â§2x): <b>${baixos}</b> ‚Ä¢ M√©dias (2‚Äì10x): <b>${medios}</b> ‚Ä¢ Altas (>10x): <b>${altos}</b><br>
        M√°x. sequ√™ncia baixa: <b>${maxSeqBaixa}</b><br>
        √öltima explos√£o (>10x): <b>${desdeAlta}</b><br>
        M√©dia m√≥vel curta (10): <b>${mediaCurta.toFixed(2)}x</b> ‚Ä¢ longa (${ultimos.length}): <b>${mediaLonga.toFixed(2)}x</b><br><br>
        üîÆ Pr√≥xima rodada estimada:<br>
        M√©dia (2‚Äì10x): <b>${probMedia}%</b><br>
        Alta (>10x): <b>${probAlta}%</b>
      `;

      if(maxSeqBaixa >= 5){
        outBox.classList.add("alerta");
        document.getElementById("beep").play();
      } else {
        outBox.classList.remove("alerta");
      }

      // gr√°fico
      const ctx = document.getElementById("chart").getContext("2d");
      if(window.grafico){ window.grafico.destroy(); }
      window.grafico = new Chart(ctx, {
        type: "line",
        data: {
          labels: ultimos.map((_,i)=>i+1),
          datasets: [{
            label: "Hist√≥rico de Rodadas",
            data: ultimos,
            borderColor: "#2ea043",
            backgroundColor: "rgba(46,160,67,0.2)",
            tension: 0.3,
            fill:true,
            pointBackgroundColor: ultimos.map(v => v>10 ? "red" : "#2ea043"),
            pointRadius: ultimos.map(v => v>10 ? 6 : 3)
          },{
            label: "M√©dia M√≥vel",
            data: Array(ultimos.length).fill(mediaLonga),
            borderColor: "orange",
            borderDash: [5,5],
            pointRadius:0
          }]
        },
        options: { responsive:true, plugins:{ legend:{labels:{color:"#000"}} }, 
          scales:{ x:{ticks:{color:"#000"}}, y:{ticks:{color:"#000"}} } }
      });

      // salvar no hist√≥rico
      historico.unshift({baixos,medios,altos,maxSeqBaixa,desdeAlta,mediaCurta,mediaLonga,probMedia,probAlta,call,cor});
      renderHistorico();
    }

    function media(arr){ return arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : 0; }

    function renderHistorico(){
      const histBox = document.getElementById("hist");
      histBox.innerHTML = historico.map((h,i) => `
        <div class="item">
          <b>An√°lise #${historico.length - i}</b><br>
          <span class="badge ${h.cor}">${h.call}</span><br>
          Baixas:${h.baixos} ‚Ä¢ M√©dias:${h.medios} ‚Ä¢ Altas:${h.altos}<br>
          Seq.baixa:${h.maxSeqBaixa} ‚Ä¢ √öltima alta:${h.desdeAlta}<br>
          Estimado ‚Üí M√©dia:${h.probMedia}% ‚Ä¢ Alta:${h.probAlta}%<br>
          <i>(M√©dia curta:${h.mediaCurta.toFixed(2)}x ‚Ä¢ longa:${h.mediaLonga.toFixed(2)}x)</i><br>
          Resultado real: <input type="text" placeholder="Ex.: 6.20x" style="width:80px;background:#0d1117;color:#fff;border:1px solid #30363d;border-radius:4px;padding:2px">
        </div>
      `).join("");
    }
  </script>
</body>
</html>