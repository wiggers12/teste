<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Desafio dos 60 Segundos 🧠</title>

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9968425306160320"
          crossorigin="anonymous"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    /* CSS aqui — o mesmo que já enviei na resposta anterior, omitido aqui para economia de espaço */
  </style>
</head>

<body>
  <h1>Desafio dos 60 Segundos 🧠</h1>

  <!-- Modo de jogo -->
  <div id="mode-selection">
    <h3>Escolha o Modo de Jogo:</h3>
    <button id="mode-kids-button">Modo Crianças</button>
    <button id="mode-adults-button">Modo Adultos</button>
  </div>

  <!-- Jogo -->
  <div id="game-container">
    <div id="status">
      <p id="timer">Tempo: <span id="timer-value">60s</span></p>
      <div id="time-bar-container"><div id="time-bar"></div></div>
      <p id="score">Pontos: <span id="score-value">0</span></p>
    </div>

    <div id="question-area">
      <p id="difficulty-level"></p>
      <p id="question">Selecione um modo e digite seu nome para começar!</p>
      <input type="text" id="player-name-input" class="hidden" placeholder="Seu nome" maxlength="20">
      <input type="number" id="answer-input" class="hidden" placeholder="Digite a resposta">
      <p id="message"></p>
    </div>

    <button id="start-game-button" class="hidden">Começar Jogo</button>
    <button id="play-again" class="hidden">Jogar Novamente</button>
  </div>

  <!-- Rankings -->
  <div id="ranking-kids-area" class="ranking-section">
    <h2>🏆 Ranking Crianças (Top 20)</h2>
    <ol id="ranking-kids-list" class="ranking-list"></ol>
  </div>

  <div id="ranking-adults-area" class="ranking-section">
    <h2>🏆 Ranking Adultos (Top 20)</h2>
    <ol id="ranking-adults-list" class="ranking-list"></ol>
  </div>

  <!-- Script do jogo -->
  <script>
    // [1] Configurar Firebase (substitua com suas credenciais)
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_DOMINIO.firebaseapp.com",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_BUCKET.appspot.com",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SEU_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // [2] Variáveis do jogo
    let modoSelecionado = null;
    let score = 0;
    let timeLeft = 60;
    let currentAnswer = null;
    let timerInterval;

    // [3] Elementos
    const modeKidsBtn = document.getElementById('mode-kids-button');
    const modeAdultsBtn = document.getElementById('mode-adults-button');
    const startBtn = document.getElementById('start-game-button');
    const playAgainBtn = document.getElementById('play-again');
    const nameInput = document.getElementById('player-name-input');
    const answerInput = document.getElementById('answer-input');
    const question = document.getElementById('question');
    const timerValue = document.getElementById('timer-value');
    const scoreValue = document.getElementById('score-value');
    const timeBar = document.getElementById('time-bar');
    const message = document.getElementById('message');

    // [4] Eventos de seleção de modo
    modeKidsBtn.addEventListener('click', () => selecionarModo('kids'));
    modeAdultsBtn.addEventListener('click', () => selecionarModo('adults'));

    function selecionarModo(modo) {
      modoSelecionado = modo;
      modeKidsBtn.classList.remove('active');
      modeAdultsBtn.classList.remove('active');
      (modo === 'kids' ? modeKidsBtn : modeAdultsBtn).classList.add('active');

      nameInput.classList.remove('hidden');
      startBtn.classList.remove('hidden');
      question.textContent = "Digite seu nome e clique em 'Começar Jogo'";
    }

    // [5] Iniciar o jogo
    startBtn.addEventListener('click', () => {
      const nome = nameInput.value.trim();
      if (!nome) return alert('Digite seu nome!');
      startBtn.classList.add('hidden');
      nameInput.classList.add('hidden');
      score = 0;
      timeLeft = 60;
      updateScore();
      startTimer();
      novaPergunta();
      answerInput.classList.remove('hidden');
      answerInput.focus();
    });

    // [6] Timer
    function startTimer() {
      timerValue.textContent = timeLeft + 's';
      timeBar.style.width = '100%';
      timerInterval = setInterval(() => {
        timeLeft--;
        timerValue.textContent = timeLeft + 's';
        timeBar.style.width = (timeLeft / 60 * 100) + '%';
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    // [7] Nova pergunta
    function novaPergunta() {
      let num1, num2;
      if (modoSelecionado === 'kids') {
        num1 = Math.floor(Math.random() * 10);
        num2 = Math.floor(Math.random() * 10);
      } else {
        num1 = Math.floor(Math.random() * 50);
        num2 = Math.floor(Math.random() * 50);
      }
      currentAnswer = num1 + num2;
      question.textContent = `${num1} + ${num2} = ?`;
    }

    // [8] Resposta
    answerInput.addEventListener('keyup', (e) => {
      if (e.key === 'Enter') verificarResposta();
    });

    function verificarResposta() {
      const resposta = parseInt(answerInput.value);
      if (resposta === currentAnswer) {
        score++;
        updateScore();
        novaPergunta();
        answerInput.value = '';
      } else {
        message.textContent = "Tente novamente!";
        setTimeout(() => message.textContent = '', 1000);
      }
    }

    function updateScore() {
      scoreValue.textContent = score;
    }

    // [9] Fim do jogo
    function endGame() {
      clearInterval(timerInterval);
      answerInput.classList.add('hidden');
      playAgainBtn.classList.remove('hidden');
      question.textContent = `Fim de jogo! Pontuação: ${score}`;
      salvarRanking();
    }

    playAgainBtn.addEventListener('click', () => {
      location.reload();
    });

    // [10] Firebase - salvar pontuação
    async function salvarRanking() {
      const nome = nameInput.value.trim();
      if (!nome) return;
      try {
        await db.collection(modoSelecionado === 'kids' ? 'ranking_kids' : 'ranking_adults').add({
          nome,
          score,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        carregarRankings();
      } catch (e) {
        console.error("Erro ao salvar ranking:", e);
      }
    }

    // [11] Carregar rankings
    async function carregarRankings() {
      const carregar = async (modo, listEl) => {
        const snapshot = await db.collection(modo).orderBy('score', 'desc').limit(20).get();
        listEl.innerHTML = '';
        snapshot.forEach((doc, i) => {
          const li = document.createElement('li');
          li.innerHTML = `<span class="ranking-position">${i + 1}.</span>
                          <span class="ranking-name">${doc.data().nome}</span>
                          <span class="ranking-score">${doc.data().score}</span>`;
          listEl.appendChild(li);
        });
      };
      carregar('ranking_kids', document.getElementById('ranking-kids-list'));
      carregar('ranking_adults', document.getElementById('ranking-adults-list'));
    }

    // [12] Carrega rankings ao iniciar
    carregarRankings();
  </script>
</body>
</html>