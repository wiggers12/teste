<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Doce Sabor Caseiro</title>
  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background: #fff0f5; margin: 0; color: #333; }
    .splash {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      height: 100vh; background: #f28ab2; color: white; text-align: center;
    }
    .splash h1 { font-size: 3rem; margin-bottom: 20px; }
    .splash button {
      background: white; color: #f28ab2; font-size: 1.2rem;
      border: none; padding: 12px 24px; border-radius: 8px;
      cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .container { display: none; padding: 20px; }
    nav {
      display: flex; flex-wrap: wrap; justify-content: space-around;
      background: #f28ab2; padding: 12px 0; position: sticky; top: 0; z-index: 10;
    }
    nav button {
      background: none; border: none; color: white; font-size: 1rem;
      font-weight: bold; cursor: pointer; transition: transform 0.2s;
    }
    nav button:hover { transform: scale(1.05); }
    section {
      display: none; background: white; padding: 20px;
      margin-top: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      max-width: 600px; margin-left: auto; margin-right: auto;
    }
    section.active { display: block; }
    h2 {
      color: #f28ab2; margin-bottom: 16px;
      border-bottom: 2px solid #f28ab2; padding-bottom: 4px;
    }
    input, select {
      width: 100%; padding: 10px; margin-bottom: 12px;
      border: 1px solid #ccc; border-radius: 8px;
      font-size: 1rem;
    }
    button.save {
      background: #f28ab2; color: white; padding: 10px 20px;
      border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
      font-size: 1rem;
    }
    ul { list-style: none; padding: 0; margin-top: 10px; max-height: 300px; overflow-y: auto; }
    li {
      background: #ffe6ec; margin-bottom: 8px; padding: 10px;
      border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);
      display: flex; justify-content: space-between; align-items: center;
    }
    li.falta { background: #ffcdd2; }
    li.baixo { background: #fff3cd; }
    li button {
      background: #f28ab2; border: none; color: white;
      border-radius: 6px; padding: 4px 8px; cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s ease;
    }
    li button:hover {
      background-color: #d66b8a;
    }
    .historico { font-size: 0.9rem; color: #555; max-height: 150px; overflow-y: auto; }
    p { font-size: 1.1rem; }
  </style>
</head>
<body>

  <div class="splash" id="splash">
    <h1>Doce Sabor Caseiro</h1>
    <button onclick="entrar()">Entrar</button>
  </div>

  <div class="container" id="app">
    <nav>
      <button onclick="mostrar('clientes')">üìã Clientes</button>
      <button onclick="mostrar('pedidos')">üßÅ Pedidos</button>
      <button onclick="mostrar('despesas')">üí∏ Despesas</button>
      <button onclick="mostrar('estoque')">üì¶ Estoque</button>
      <button onclick="mostrar('financeiro')">üìä Financeiro</button>
    </nav>

    <!-- Clientes -->
    <section id="clientes" class="active">
      <h2>Cadastro de Clientes</h2>
      <input id="clienteNome" placeholder="Nome do cliente" />
      <input id="clienteTelefone" placeholder="Telefone" />
      <input id="clienteEndereco" placeholder="Endere√ßo" />
      <button class="save" onclick="salvarCliente()">Salvar</button>
      <input id="buscaCliente" placeholder="Buscar cliente..." oninput="listarClientes()" />
      <ul id="listaClientes"></ul>
    </section>

    <!-- Pedidos -->
    <section id="pedidos">
      <h2>Pedidos</h2>
      <input id="pedidoCliente" placeholder="Nome do cliente" />
      <input id="tipoProduto" placeholder="Tipo de produto" />
      <input id="valorPedido" type="number" placeholder="Valor (R$)" />
      <input id="dataEntrega" type="date" />
      <select id="formaEntrega">
        <option value="Entregar">Entregar</option>
        <option value="Retirar">Retirar</option>
      </select>
      <button class="save" onclick="salvarPedido()">Salvar Pedido</button>
      <ul id="listaPedidos"></ul>
    </section>

    <!-- Despesas -->
    <section id="despesas">
      <h2>Despesas</h2>
      <div style="background:#fff0f5; padding:16px; border-radius:12px; margin-bottom:16px; box-shadow:0 1px 4px rgba(0,0,0,0.1); max-width:500px;">
        <label style="display:block; margin-bottom:8px; font-weight:600; color:#b64d6d;">
          Categoria:
          <select id="categoriaDespesa" style="width:100%; padding:8px; margin-top:4px; border-radius:6px; border:1px solid #ccc;">
            <option>Mercadorias</option>
            <option>Loja</option>
            <option>Pessoais</option>
          </select>
        </label>
        <label style="display:block; margin-bottom:8px; font-weight:600; color:#b64d6d;">
          Descri√ß√£o da despesa:
          <input type="text" id="descricaoDespesa" placeholder="Descri√ß√£o..." style="width:100%; padding:8px; margin-top:4px; border-radius:6px; border:1px solid #ccc;" />
        </label>
        <label style="display:block; margin-bottom:8px; font-weight:600; color:#b64d6d;">
          Data da despesa:
          <input type="date" id="dataDespesa" style="width:100%; padding:8px; margin-top:4px; border-radius:6px; border:1px solid #ccc;" />
        </label>
        <label style="display:block; margin-bottom:12px; font-weight:600; color:#b64d6d;">
          Valor (R$):
          <input type="number" step="0.01" min="0" id="valorDespesa" placeholder="0,00" style="width:100%; padding:8px; margin-top:4px; border-radius:6px; border:1px solid #ccc;" />
        </label>
        <button class="save" onclick="salvarDespesa()">Salvar</button>
      </div>
      <div style="max-width:500px; margin-bottom:16px;">
        <label for="buscaDescricaoDespesa" style="font-weight:600; color:#b64d6d;">Buscar despesas pelo nome:</label>
        <div style="display:flex; gap:8px; margin-top:6px;">
          <input type="text" id="buscaDescricaoDespesa" placeholder="Digite descri√ß√£o para buscar..." style="flex:1; padding:8px; border-radius:6px; border:1px solid #ccc;" onkeydown="if(event.key==='Enter'){filtrarDespesas()}" />
          <button onclick="filtrarDespesas()" style="background:#f28ab2; color:#fff; border:none; border-radius:6px; padding:0 16px; cursor:pointer; font-weight:bold;">Buscar</button>
        </div>
      </div>
      <button id="btnVerDespesas" onclick="toggleListaDespesas()" style="background:#b64d6d; color:#fff; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; margin-bottom:12px; max-width:500px;">
        Ver despesas
      </button>
      <ul id="listaDespesas" style="max-width:500px; max-height:300px; overflow-y:auto; margin-top:12px; padding-left:0; list-style:none; display:none;"></ul>
    </section>

    <!-- Estoque -->
    <section id="estoque">
      <h2>Controle de Estoque</h2>
      <input id="produtoNome" placeholder="Nome do Produto" />
      <select id="produtoTipo">
        <option value="Ingrediente">Ingrediente</option>
        <option value="Embalagem">Embalagem</option>
        <option value="Produto Final">Produto Final</option>
      </select>
      <input id="produtoQtd" type="number" placeholder="Quantidade" />
      <input id="produtoMin" type="number" placeholder="M√≠nimo Ideal" />
      <input id="produtoValidade" type="date" />
      <button class="save" onclick="adicionarProduto()">Adicionar Produto</button>
      <input id="buscaProduto" placeholder="Buscar produto..." oninput="listarProdutos()" />
      <select id="filtroTipo" onchange="listarProdutos()">
        <option value="">Todos</option>
        <option value="Ingrediente">Ingrediente</option>
        <option value="Embalagem">Embalagem</option>
        <option value="Produto Final">Produto Final</option>
      </select>
      <ul id="listaEstoque"></ul>
      <h3>Hist√≥rico</h3>
      <ul id="listaHistorico" class="historico"></ul>
    </section>

    <!-- Financeiro -->
    <section id="financeiro">
      <h2>Financeiro</h2>
      <p><strong>Ganhos:</strong> R$ <span id="ganhos">0.00</span></p>
      <p><strong>Gastos:</strong> R$ <span id="gastos">0.00</span></p>
      <p><strong>Lucros:</strong> R$ <span id="lucros">0.00</span></p>
    </section>
  </div>

  <script>
    function entrar() {
      document.getElementById('splash').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      atualizarTudo();
    }

    function mostrar(secao) {
      document.querySelectorAll('section').forEach((s) => s.classList.remove('active'));
      document.getElementById(secao).classList.add('active');
    }

    // CLIENTES
    function salvarCliente() {
      const nome = document.getElementById('clienteNome').value.trim();
      const telefone = document.getElementById('clienteTelefone').value.trim();
      const endereco = document.getElementById('clienteEndereco').value.trim();
      if (!nome || !telefone || !endereco) {
        alert('Preencha todos os campos');
        return;
      }
      let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
      clientes.push({ nome, telefone, endereco });
      localStorage.setItem('clientes', JSON.stringify(clientes));
      document.getElementById('clienteNome').value = '';
      document.getElementById('clienteTelefone').value = '';
      document.getElementById('clienteEndereco').value = '';
      listarClientes();
    }
    function listarClientes() {
      const termo = document.getElementById('buscaCliente').value.toLowerCase();
      const lista = document.getElementById('listaClientes');
      lista.innerHTML = '';
      let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
      clientes.forEach((c) => {
        if (!c.nome.toLowerCase().includes(termo)) return;
        const li = document.createElement('li');
        li.textContent = `${c.nome} - ${c.telefone} (${c.endereco})`;
        lista.appendChild(li);
      });
    }

    // PEDIDOS
    function salvarPedido() {
      const nome = document.getElementById('pedidoCliente').value.trim();
      const produto = document.getElementById('tipoProduto').value.trim();
      const valor = parseFloat(document.getElementById('valorPedido').value);
      const entrega = document.getElementById('formaEntrega').value;
      const data = document.getElementById('dataEntrega').value;
      if (!nome || !produto || isNaN(valor) || !data) {
        alert('Preencha todos os campos');
        return;
      }
      let pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
      pedidos.push({ nome, produto, valor, entrega, data });
      localStorage.setItem('pedidos', JSON.stringify(pedidos));
      document.getElementById('pedidoCliente').value = '';
      document.getElementById('tipoProduto').value = '';
      document.getElementById('valorPedido').value = '';
      document.getElementById('dataEntrega').value = '';
      atualizarFinanceiro();
      listarPedidos();
    }
    function listarPedidos() {
      const lista = document.getElementById('listaPedidos');
      lista.innerHTML = '';
      let pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
      pedidos.forEach((p) => {
        const li = document.createElement('li');
        li.textContent = `${p.nome} - ${p.produto} - R$${p.valor.toFixed(2)} - ${p.entrega} (${p.data})`;
        lista.appendChild(li);
      });
    }

    // DESPESAS
    let listaDespesasVisivel = false;

    function salvarDespesa() {
      const categoria = document.getElementById('categoriaDespesa').value;
      const descricao = document.getElementById('descricaoDespesa').value.trim();
      const data = document.getElementById('dataDespesa').value;
      const valor = parseFloat(document.getElementById('valorDespesa').value);
      if (!descricao || !data || isNaN(valor)) {
        alert('Preencha todos os campos corretamente!');
        return;
      }
      let despesas = JSON.parse(localStorage.getItem('despesas') || '[]');
      despesas.push({ categoria, descricao, data, valor });
      localStorage.setItem('despesas', JSON.stringify(despesas));
      document.getElementById('descricaoDespesa').value = '';
      document.getElementById('dataDespesa').value = '';
      document.getElementById('valorDespesa').value = '';
      alert('Despesa salva com sucesso! Para ver a lista, clique em "Ver despesas".');
      atualizarFinanceiro();
    }

    function filtrarDespesas() {
      let despesas = JSON.parse(localStorage.getItem('despesas') || '[]');
      const termo = document.getElementById('buscaDescricaoDespesa').value.toLowerCase();
      const lista = document.getElementById('listaDespesas');
      lista.innerHTML = '';
      const filtradas = despesas.filter((d) => d.descricao.toLowerCase().includes(termo));
      if (filtradas.length === 0) {
        lista.innerHTML = '<li style="color:#999; font-style:italic;">Nenhuma despesa encontrada.</li>';
        return;
      }
      filtradas.forEach((d) => {
        const li = document.createElement('li');
        li.textContent = `${d.data} | ${d.categoria} | ${d.descricao} - R$ ${d.valor.toFixed(2)}`;
        lista.appendChild(li);
      });
    }

    function toggleListaDespesas() {
      listaDespesasVisivel = !listaDespesasVisivel;
      const lista = document.getElementById('listaDespesas');
      lista.style.display = listaDespesasVisivel ? 'block' : 'none';
      if (listaDespesasVisivel) filtrarDespesas();
      const btn = document.getElementById('btnVerDespesas');
      btn.textContent = listaDespesasVisivel ? 'Ocultar despesas' : 'Ver despesas';
    }

    function listarDespesas() {
      let despesas = JSON.parse(localStorage.getItem('despesas') || '[]');
      const lista = document.getElementById('listaDespesas');
      lista.innerHTML = '';
      if (despesas.length === 0) {
        lista.innerHTML = '<li style="color:#999; font-style:italic;">Nenhuma despesa cadastrada.</li>';
        return;
      }
      despesas.forEach((d) => {
        const li = document.createElement('li');
        li.textContent = `${d.data} | ${d.categoria} | ${d.descricao} - R$ ${d.valor.toFixed(2)}`;
        lista.appendChild(li);
      });
    }

    // ESTOQUE
    function adicionarProduto() {
      const nome = document.getElementById('produtoNome').value.trim();
      const tipo = document.getElementById('produtoTipo').value;
      const qtd = parseInt(document.getElementById('produtoQtd').value);
      const min = parseInt(document.getElementById('produtoMin').value);
      const validade = document.getElementById('produtoValidade').value;
      if (!nome || isNaN(qtd)) {
        alert('Preencha nome e quantidade corretamente');
        return;
      }
      let estoque = JSON.parse(localStorage.getItem('estoque') || '[]');
      // Verificar se produto j√° existe para somar quantidade
      const existente = estoque.find(p => p.nome.toLowerCase() === nome.toLowerCase());
      if (existente) {
        existente.qtd += qtd;
        existente.min = min || existente.min;
        existente.validade = validade || existente.validade;
      } else {
        estoque.push({ nome, tipo, qtd, min: min || 0, validade });
      }
      localStorage.setItem('estoque', JSON.stringify(estoque));
      adicionarHistorico(`Adicionado ${qtd} de ${nome} (${tipo})`);
      document.getElementById('produtoNome').value = '';
      document.getElementById('produtoQtd').value = '';
      document.getElementById('produtoMin').value = '';
      document.getElementById('produtoValidade').value = '';
      listarProdutos();
    }

    function listarProdutos() {
      const termo = document.getElementById('buscaProduto').value.toLowerCase();
      const filtro = document.getElementById('filtroTipo').value;
      const lista = document.getElementById('listaEstoque');
      lista.innerHTML = '';
      let estoque = JSON.parse(localStorage.getItem('estoque') || '[]');
      estoque.forEach(p => {
        if (termo && !p.nome.toLowerCase().includes(termo)) return;
        if (filtro && p.tipo !== filtro) return;
        const li = document.createElement('li');
        li.className = p.qtd <= 0 ? 'falta' : p.qtd < p.min ? 'baixo' : '';
        li.textContent = `${p.nome} (${p.tipo}) - Qtde: ${p.qtd} - M√≠nimo: ${p.min} ${p.validade ? '| V√°lido at√©: ' + p.validade : ''}`;
        const btnUsar = document.createElement('button');
        btnUsar.textContent = 'Usar 1';
        btnUsar.onclick = () => usarProduto(p.nome);
        li.appendChild(btnUsar);
        lista.appendChild(li);
      });
    }

    function usarProduto(nome) {
      let estoque = JSON.parse(localStorage.getItem('estoque') || '[]');
      const produto = estoque.find(p => p.nome.toLowerCase() === nome.toLowerCase());
      if (!produto || produto.qtd <= 0) {
        alert('Produto em falta ou inexistente!');
        return;
      }
      produto.qtd--;
      localStorage.setItem('estoque', JSON.stringify(estoque));
      adicionarHistorico(`Usado 1 de ${produto.nome}`);
      listarProdutos();
    }

    // Hist√≥rico do estoque
    function adicionarHistorico(texto) {
      let historico = JSON.parse(localStorage.getItem('historico') || '[]');
      const data = new Date().toLocaleString('pt-BR');
      historico.unshift(`${data}: ${texto}`);
      if (historico.length > 50) historico.pop();
      localStorage.setItem('historico', JSON.stringify(historico));
      listarHistorico();
    }

    function listarHistorico() {
      let historico = JSON.parse(localStorage.getItem('historico') || '[]');
      const lista = document.getElementById('listaHistorico');
      lista.innerHTML = '';
      historico.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        lista.appendChild(li);
      });
    }

    // FINANCEIRO
    function atualizarFinanceiro() {
      let pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
      let despesas = JSON.parse(localStorage.getItem('despesas') || '[]');
      let ganhos = pedidos.reduce((acc, p) => acc + p.valor, 0);
      let gastos = despesas.reduce((acc, d) => acc + d.valor, 0);
      let lucros = ganhos - gastos;
      document.getElementById('ganhos').textContent = ganhos.toFixed(2);
      document.getElementById('gastos').textContent = gastos.toFixed(2);
      document.getElementById('lucros').textContent = lucros.toFixed(2);
    }

    function atualizarTudo() {
      listarClientes();
      listarPedidos();
      listarProdutos();
      listarHistorico();
      atualizarFinanceiro();
    }
  </script>

</body>
</html>
